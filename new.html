<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أطراف الدعوى - محامين مصر الرقمية</title>
    
    <!-- Tailwind CSS Local -->
    <link rel="stylesheet" href="css/tailwind.min.css">
    
    <!-- Remix Icons Local -->
    <link rel="stylesheet" href="css/remixicon.css">
    
    <!-- Link to the main stylesheet -->
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        /* Remove all animations and transitions for low-power devices */
        *, *::before, *::after {
            animation-duration: 0s !important;
            animation-delay: 0s !important;
            transition-duration: 0s !important;
            transition-delay: 0s !important;
        }
        
        /* Light Theme inspired by search page */
        html, body {
            background: linear-gradient(135deg, #334155, #111827, #1e3a8a) !important;
            min-height: 100vh !important;
            color: #0f172a !important; /* slate-900 */
        }
        
        body.min-h-screen {
            background: transparent !important;
        }
        
        /* Override any Tailwind background classes */
        .min-h-screen {
            background: transparent !important;
        }

        /* Light-friendly styling for case details inside new.html */
        #embedded-content .bg-gradient-to-br,
        #modal #modal-content .bg-gradient-to-br {
            /* Tailwind blue-50 */
            background-color: #eff6ff !important;
            background-image: none !important;
            /* Tailwind blue-300 */
            border-color: #93c5fd !important;
        }
        /* Inner boxes */
        #case-details-form .bg-white, 
        #case-details-form .bg-white\/90,
        #case-details-form .bg-white\/95 {
            /* Tailwind blue-50 */
            background-color: #eff6ff !important;
        }
        /* Inputs, selects, textareas */
        #case-details-form input,
        #case-details-form select,
        #case-details-form textarea {
            background-color: #ffffff !important;
            border: 2px solid #93c5fd !important;
            color: #0f172a !important; /* slate-900 */
        }
        #case-details-form label { color: #0f172a !important; }
        #case-details-form .text-gray-700 { color: #0f172a !important; }
        /* Borders in the form */
        #case-details-form .border-blue-200,
        #case-details-form .border-blue-300 { border-color: #93c5fd !important; }
        /* Accent icons */
        #case-details-form .text-blue-600 { color: #2563eb !important; }
        /* Error text keeps red */
        #case-details-form #case-number-error { color: #ef4444 !important; }

        /* Reduce excessive borders when embedded */
        #embedded-content > div.border { border: 0 !important; box-shadow: none !important; }
        #case-details-form .border { border-color: rgba(59,130,246,0.25) !important; }

        /* Simplify and unify buttons styling inside case form */
        #case-details-form button[type="submit"],
        #next-to-case-details-btn,
        #save-case-btn {
            background: #2563eb !important; /* blue-600 */
            border: 1px solid #1d4ed8 !important; /* blue-700 */
            color: #fff !important;
            box-shadow: none !important;
            transform: none !important;
            border-radius: 0.5rem !important;
            padding: 0.5rem 1rem !important;
            min-height: 40px !important;
            min-width: 40px !important;
            font-size: 14px !important;
            letter-spacing: .2px;
        }
        #party-details-actions > div:first-child { max-width: 200px; width: 100%; }
        #case-details-form button[type="submit"]:hover,
        #next-to-case-details-btn:hover,
        #save-case-btn:hover {
            background: #1d4ed8 !important; /* blue-700 */
            border-color: #1e40af !important; /* blue-800 */
        }

        /* Unify session save button */
        #session-form button[type="submit"] {
            background: #2563eb !important; /* blue-600 */
            border: 1px solid #1d4ed8 !important; /* blue-700 */
            color: #fff !important;
            box-shadow: none !important;
            transform: none !important;
            border-radius: 0.5rem !important;
            padding: 0.5rem 1rem !important;
            min-height: 40px !important;
            min-width: 140px !important;
            font-size: 14px !important;
            letter-spacing: .2px;
        }
        #session-form button[type="submit"]:hover {
            background: #1d4ed8 !important; /* blue-700 */
            border-color: #1e40af !important; /* blue-800 */
        }

        /* Manage sessions button as secondary style */
        #manage-sessions-btn {
            background: #1d4ed8 !important; /* blue-700 */
            border: 1px solid #1e40af !important; /* blue-800 */
            color: #ffffff !important;
            box-shadow: none !important;
            transform: none !important;
            border-radius: 0.5rem !important;
            padding: 0.75rem 1.25rem !important;
            min-height: 56px !important;
            min-width: 200px !important;
            font-size: 16px !important;
            gap: 0.5rem !important;
        }
        #manage-sessions-btn:hover {
            background: #1e40af !important; /* blue-800 */
            border-color: #1e3a8a !important; /* blue-900 */
        }
        #manage-sessions-btn > div.w-12 { display: none !important; }
        #manage-sessions-btn i { color: #ffffff !important; }
        #manage-sessions-btn .text-purple-100 { color: #ffffff !important; }

        /* Enlarge save session button */
        #session-form button[type="submit"] {
            padding: 0.75rem 1.25rem !important;
            min-height: 56px !important;
            min-width: 200px !important;
            font-size: 16px !important;
            gap: 0.5rem !important;
            border-radius: 0.5rem !important;
            background: #2563eb !important; /* blue-600 */
            border: 1px solid #1d4ed8 !important; /* blue-700 */
            color: #fff !important;
        }

        #party-details-actions > .text-xs { display: none !important; }

        /* Autocomplete dropdown - استخدم الستايل العام من css/style.css لضمان التطابق التام */

        /* Session modal: light labels */
        #modal #modal-content label,
        #modal #modal-content .text-gray-700,
        #modal #modal-content .text-gray-800,
        #modal #modal-content .text-gray-600,
        #modal #modal-content h1,
        #modal #modal-content h2,
        #modal #modal-content h3 {
            color: #0f172a !important;
        }

        /* Ensure inner boxes use light bg in modal */
        #modal #modal-content .bg-white,
        #modal #modal-content .bg-white\/90,
        #modal #modal-content .bg-white\/95 {
            background-color: #ffffff !important;
        }

        #modal #modal-content input,
        #modal #modal-content select,
        #modal #modal-content textarea {
            background-color: #ffffff !important;
            border: 2px solid #93c5fd !important;
            color: #0f172a !important;
        }

        /* Embedded content inputs */
        #embedded-content label,
        #embedded-content .text-gray-700,
        #embedded-content .text-gray-800,
        #embedded-content .text-gray-600,
        #embedded-content h1,
        #embedded-content h2,
        #embedded-content h3 {
            color: #0f172a !important;
        }
        #embedded-content .bg-white,
        #embedded-content .bg-white\/90,
        #embedded-content .bg-white\/95 { 
            background-color: #ffffff !important;
        }
        #embedded-content input,
        #embedded-content select,
        #embedded-content textarea {
            background-color: #ffffff !important;
            border: 2px solid #93c5fd !important;
            color: #0f172a !important;
        }

        /* Reduce top gap between page title and first row in case-details view */
        #embedded-content { margin-top: 0 !important; }
        #embedded-content > .bg-gradient-to-br { padding-top: 0.375rem !important; }
        
        /* Ensure full height coverage */
        html, body {
            height: 100vh !important;
            overflow-x: hidden;
        }
        
        #party-form-container {
            min-height: calc(100vh - 48px) !important;
            height: auto !important;
        }
        
        /* Make form stretch to full height */
        #party-details-form {
            min-height: calc(100vh - 80px) !important;
            display: flex !important;
            flex-direction: column !important;
        }
        
        /* Ensure the main content areas expand */
        .flex-row.items-center.gap-6 {
            flex: 1 !important;
            align-items: stretch !important;
        }

        /* Mobile uniform form sizing and spacing */
        @media (max-width: 640px) {
            /* Fix label width across all rows in party forms (client/opponent) */
            #party-form-container .flex.items-stretch > label {
                width: 8rem !important; /* same as Tailwind w-32 */
                min-width: 8rem !important;
                padding-right: 1rem !important;
                padding-left: 1rem !important;
            }

            /* Ensure input containers align to the same height */
            #party-form-container .flex.items-stretch > .relative,
            #party-form-container .flex.items-stretch > input {
                min-height: 48px !important;
            }

            /* Uniform input/select/textarea sizing across the page */
            #party-form-container input,
            #party-form-container select,
            #party-form-container textarea,
            #case-details-form input,
            #case-details-form select,
            #case-details-form textarea {
                min-height: 48px !important;
                height: 48px !important;
                padding-top: 0.75rem !important;
                padding-bottom: 0.75rem !important;
                padding-right: 1rem !important;
                padding-left: 1rem !important;
                font-size: 14px !important;
                line-height: 1.25rem !important;
            }

            /* Toggle buttons inside autocomplete align with input height */
            .autocomplete-container button[id$='-toggle'] {
                height: 100% !important;
            }

            /* Uniform vertical spacing between rows */
            #party-form-container .space-y-3 > * + * { margin-top: 0.75rem !important; }
            #case-details-form .space-y-4 > * + * { margin-top: 0.75rem !important; }

            /* Consistent gap between label and input (remove accidental gaps) */
            #party-form-container .flex.items-stretch { gap: 0 !important; }

            /* Consistent corner radii between label and input */
            #party-form-container .flex.items-stretch > label {
                border-top-left-radius: 0 !important;
                border-bottom-left-radius: 0 !important;
            }
            #party-form-container .flex.items-stretch > .relative > input,
            #party-form-container .flex.items-stretch > input {
                border-top-right-radius: 0 !important;
                border-bottom-right-radius: 0 !important;
            }
        }
    /* Extra mobile fixes to prevent overflow on some devices */
        @media (max-width: 640px) {
            /* Ensure rows never exceed container width */
            #party-form-container .flex.items-stretch {
                width: 100% !important;
                overflow: visible !important; /* allow dropdowns to escape row height */
            }
            /* Allow inputs to shrink and not overflow */
            #party-form-container .flex.items-stretch > .relative,
            #party-form-container .flex.items-stretch > input {
                flex: 1 1 auto !important;
                min-width: 0 !important;
                max-width: 100% !important;
            }
            /* Ensure autocomplete wrappers are constrained */
            #party-form-container .autocomplete-container {
                width: 100% !important;
                max-width: 100% !important;
            }
            /* Cap inputs width to container */
            #party-form-container input,
            #party-form-container select,
            #party-form-container textarea {
                max-width: 100% !important;
            }
            /* Specifically cap phone inputs */
            #client-phone,
            #opponent-phone {
                width: 100% !important;
                max-width: 100% !important;
            }

            /* Make case details labels attached to inputs in a single row */
            #case-details-form .space-y-4 > div {
                display: flex !important;
                align-items: stretch !important;
                gap: 0 !important;
                width: 100% !important;
            }
            #case-details-form .space-y-4 > div > label {
                width: 8rem !important;
                min-width: 8rem !important;
                margin-bottom: 0 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                padding: 0 1rem !important;
                border: 2px solid #93c5fd !important;
                background-color: #eff6ff !important;
                border-top-left-radius: 0 !important;
                border-bottom-left-radius: 0 !important;
                border-top-right-radius: 0.5rem !important;
                border-bottom-right-radius: 0.5rem !important;
            }
            #case-details-form .space-y-4 > div > :not(label) {
                flex: 1 1 auto !important;
                min-width: 0 !important;
                max-width: 100% !important;
            }
            #case-details-form .space-y-4 > div > .relative > input,
            #case-details-form .space-y-4 > div > div > input,
            #case-details-form .space-y-4 > div > input,
            #case-details-form .space-y-4 > div > select,
            #case-details-form .space-y-4 > div > textarea {
                border-top-right-radius: 0 !important;
                border-bottom-right-radius: 0 !important;
                margin-right: -1px !important; /* glue borders with label */
                height: 48px !important;
            }
            #case-details-form .space-y-4 > div > .relative > button {
                height: 100% !important;
            }

            /* Session form labels attached to inputs */
            #session-form .flex.items-stretch {
                gap: 0 !important;
                width: 100% !important;
                overflow: hidden !important;
            }
            #session-form .flex.items-stretch > label {
                width: 8rem !important;
                min-width: 8rem !important;
                padding-right: 0.75rem !important;
                padding-left: 0.75rem !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                border-top-left-radius: 0 !important;
                border-bottom-left-radius: 0 !important;
                border-top-right-radius: 0.5rem !important;
                border-bottom-right-radius: 0.5rem !important;
            }
            #session-form .flex.items-stretch > .relative,
            #session-form .flex.items-stretch > input,
            #session-form .flex.items-stretch > textarea {
                flex: 1 1 auto !important;
                min-width: 0 !important;
                max-width: 100% !important;
            }
            #session-form .flex.items-stretch > .relative > input,
            #session-form .flex.items-stretch > input,
            #session-form .flex.items-stretch > select {
                height: 48px !important;
                border-top-right-radius: 0 !important;
                border-bottom-right-radius: 0 !important;
                margin-right: -1px !important;
            }
            #session-form .flex.items-stretch > .relative > button {
                height: 100% !important;
            }
            /* Textareas keep multi-line but align borders with label */
            #session-form .flex.items-stretch > textarea {
                min-height: 120px !important;
                border-top-right-radius: 0 !important;
                border-bottom-right-radius: 0 !important;
                margin-right: -1px !important;
                resize: vertical !important;
            }
        }
    /* Desktop layout: match old design for case details, keep mobile as-is */
        @media (min-width: 768px) {
            /* Two-column grid inside case details section */
            #case-details-form .p-4.bg-blue-50 > .space-y-4 {
                display: grid !important;
                grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
                column-gap: 1.5rem !important; /* gap-x-6 */
                row-gap: 1.25rem !important;    /* gap-y-5 */
                grid-auto-flow: row dense !important;
                align-items: start !important;
            }
            /* Remove vertical margins added by space-y-4 in grid context */
            #case-details-form .p-4.bg-blue-50 > .space-y-4 > * { margin-top: 0 !important; }
            /* Force first two fields to share the first row: court and circuitNumber */
            #case-details-form .p-4.bg-blue-50 > .space-y-4 > div:nth-child(1) {
                grid-column: 1 !important;
                grid-row: 1 !important;
            }
            #case-details-form .p-4.bg-blue-50 > .space-y-4 > div:nth-child(2) {
                grid-column: 2 !important;
                grid-row: 1 !important;
            }
            /* Each field row becomes a flex row with attached label */
            #case-details-form .p-4.bg-blue-50 > .space-y-4 > div {
                display: flex !important;
                align-items: stretch !important;
                gap: 0 !important;
                width: 100% !important;
            }
            #case-details-form .p-4.bg-blue-50 > .space-y-4 > div > label {
                width: 8rem !important;      /* md:w-32 */
                min-width: 8rem !important;
                min-height: 48px !important;
                height: 48px !important;
                margin-bottom: 0 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                padding: 0 0.75rem !important;
                border: 2px solid #9ca3af !important;     /* gray-400 */
                background-color: #f3f4f6 !important;     /* gray-100 */
                color: #374151 !important;                 /* gray-700 */
                font-weight: 700 !important;               /* font-bold */
                font-size: 0.875rem !important;            /* text-sm */
                border-top-left-radius: 0 !important;
                border-bottom-left-radius: 0 !important;
                border-top-right-radius: 0.5rem !important;
                border-bottom-right-radius: 0.5rem !important;
                box-sizing: border-box !important;
            }
            #case-details-form .p-4.bg-blue-50 > .space-y-4 > div > :not(label) {
                flex: 1 1 auto !important;
                min-width: 0 !important;
                max-width: 100% !important;
            }
            /* Inputs/select fixed height */
            #case-details-form .p-4.bg-blue-50 > .space-y-4 > div > .relative > input,
            #case-details-form .p-4.bg-blue-50 > .space-y-4 > div > div > input,
            #case-details-form .p-4.bg-blue-50 > .space-y-4 > div > input,
            #case-details-form .p-4.bg-blue-50 > .space-y-4 > div > select {
                height: 48px !important;
                border-top-right-radius: 0 !important;
                border-bottom-right-radius: 0 !important;
                margin-right: -1px !important; /* merge border with label */
                box-sizing: border-box !important;
            }
            /* Textareas remain flexible height */
            #case-details-form .p-4.bg-blue-50 > .space-y-4 > div > textarea {
                min-height: 48px !important;
                height: auto !important;
                border-top-right-radius: 0 !important;
                border-bottom-right-radius: 0 !important;
                margin-right: -1px !important; /* merge border with label */
                box-sizing: border-box !important;
            }
            #case-details-form .p-4.bg-blue-50 > .space-y-4 > div > .relative > button {
                height: 100% !important;
            }
            /* Normalize every row container height */
            #case-details-form .p-4.bg-blue-50 > .space-y-4 > div > .relative {
                min-height: 48px !important;
                height: 48px !important;
                display: flex !important;
                align-items: stretch !important;
                box-sizing: border-box !important;
            }

            /* Actions row spans both columns */
            #case-details-form .p-4.bg-blue-50 .flex.flex-row.flex-wrap.items-center.justify-center {
                grid-column: 1 / -1 !important;
                padding-top: 1rem !important;
            }
            /* Court row specific alignment to match others */
            #case-details-form label[for="court"] {
                width: 8rem !important;
                min-width: 8rem !important;
                min-height: 48px !important;
                height: 48px !important;
                margin-bottom: 0 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                padding: 0 0.75rem !important;
                border: 2px solid #9ca3af !important;
                background-color: #f3f4f6 !important;
                color: #374151 !important;
                font-weight: 700 !important;
                font-size: 0.875rem !important;
                border-top-left-radius: 0 !important;
                border-bottom-left-radius: 0 !important;
                border-top-right-radius: 0.5rem !important;
                border-bottom-right-radius: 0.5rem !important;
                box-sizing: border-box !important;
            }
            #case-details-form label[for="court"] + .relative {
                flex: 1 1 auto !important;
                min-width: 0 !important;
                max-width: 100% !important;
                min-height: 48px !important;
                height: 48px !important;
                display: flex !important;
                align-items: stretch !important;
                box-sizing: border-box !important;
            }
            #case-details-form #court {
                min-height: 48px !important;
                height: 48px !important;
                border-top-right-radius: 0 !important;
                border-bottom-right-radius: 0 !important;
                margin-right: -1px !important;
                box-sizing: border-box !important;
            }
            #case-details-form #court ~ button {
                height: 100% !important;
            }
            /* Ensure container uses screen width similar to old layout and remains scrollable */
            main[style] { overflow: auto !important; }
            #embedded-content { overflow: auto !important; padding-top: 0 !important; }
            #embedded-content > .bg-white {
                width: 100% !important;
                max-width: none !important;
                margin-left: 0 !important;
                margin-right: 0 !important;
                padding-top: 0.25rem !important; /* reduce top padding to raise content */
                padding-bottom: 1rem !important;
                max-height: calc(100vh - 96px) !important; /* prevent bottom overflow */
                overflow: auto !important;               /* scroll inside container */
                box-sizing: border-box !important;
            }
            /* Reduce inner blue box top padding to pull first row up */
            #case-details-form .p-4.bg-blue-50 { padding-top: 0.5rem !important; }

            /* Desktop: make "حفظ ومتابعة للقضية" same size as "حفظ ومتابعة للجلسات" */
            #next-to-case-details-btn {
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 0.5rem !important;
                padding: 0.75rem 1.25rem !important;
                min-height: 56px !important;
                min-width: 200px !important;
                font-size: 16px !important;
                border-radius: 0.5rem !important;
            }
            /* Remove width cap from its wrapper to avoid shrinking the button */
            #party-details-actions > div:first-child { max-width: none !important; width: auto !important; }
        }
    </style>
</head>
<body class="h-screen overflow-hidden flex flex-col bg-slate-100">
    
    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-40 px-2 py-1 bg-blue-900 border-b border-blue-900">
        <div class="grid grid-cols-3 items-center">
            <!-- Back Button (right column) -->
            <div class="justify-self-start">
                <button id="back-to-main" class="inline-flex items-center gap-1 px-2 py-1 bg-transparent border border-white/20 rounded-full shadow-sm text-white hover:bg-white/10 text-sm">
                    <i class="ri-arrow-right-line text-white text-base"></i>
                    <span class="text-white">الرئيسيه</span>
                </button>
            </div>
            
            <!-- Title (center column, click to copy) -->
            <div class="justify-self-center">
                <button id="copyable-title" class="inline-flex items-center gap-1 px-3 py-1 bg-transparent border border-white/20 rounded-full shadow-sm text-white hover:bg-white/10 text-sm font-semibold" title="اضغط للنسخ">
                    <i class="ri-user-3-line text-white text-base"></i>
                    <span class="text-sm font-semibold text-white" id="page-title">إدخال بيانات الأطراف</span>
                </button>
            </div>
            
            <!-- Spacer (left column) -->
            <div class="justify-self-end"></div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 p-0" style="padding-top: 48px; height: calc(100vh - 48px); overflow:auto;">
        <div class="w-full h-full">
            <div class="border-0 bg-white h-full">
                <!-- Party Details Form will be inserted here -->
                <div id="party-form-container" class="p-4 bg-blue-50 border-2 border-blue-300 rounded-xl shadow-md h-full">
                    <!-- Form content will be loaded by JavaScript -->
                </div>
                <div id="embedded-content" class="mt-0"></div>
            </div>
        </div>
    </main>
    
    <!-- Modal for case details -->
    <div id="modal" class="fixed inset-0 bg-black/60 hidden z-50 overflow-y-auto">
        <div class="flex items-start justify-center min-h-screen py-3 px-3">
            <div id="modal-container" class="bg-white/95 rounded-lg max-w-5xl w-[96vw] my-6 border border-blue-200 shadow-xl backdrop-blur-md">
                <div class="flex justify-between items-center mb-2 px-4 py-3 border-b border-blue-200/60">
                    <button id="modal-close-button" class="text-gray-600 hover:text-gray-800">
                        <i class="ri-close-line text-xl"></i>
                    </button>
                    <h2 id="modal-title" class="text-lg font-semibold text-gray-900"></h2>
                </div>
                <div id="modal-content" class="px-4 pb-4 text-gray-900"></div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Load required JavaScript files -->
    <script src="js/state.js"></script>
    <script src="js/db.js"></script>
    <script src="js/toast.js"></script>
    <script src="js/autocomplete.js"></script>
    <script src="js/modal.js"></script>
    <script src="js/header.js"></script>
    <script src="js/sessions.js"></script>
    <script src="js/new-page.js"></script>
</body>
</html>